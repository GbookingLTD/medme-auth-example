<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Hello</title>
</head>

<body>

</body>
<script>
    const CLIENT_ID = '5e4bd655a719ad41e8bcbf79';

    // We can get the token from the "access_token" query
    // param, available in the browsers "location" global
    const query = window.location.search.substring(1)
    const code = query.split('code=')[1]

    let requestCounter = 1;

    fetch('https://oauthv2.gbooking.ru/exchange', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            code,
            client_id: CLIENT_ID,
            redirect_uri: 'http://gbooking.local/welcome.html'
        })
    })
        // Parse the response as JSON
        .then(res => res.json())
        .then(res =>
            printUser(res.user, res.token));

    function printUser(user, token) {
        // Call the user info API using the fetch browser library
        fetch('https://apiv2.gbooking.ru/rpc', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                jsonrpc: "2.0",
                id: requestCounter++,
                cred: {user, token},
                method: "profile.get_profile",
                params: {
                    id: user
                }
            })
        })
            // Parse the response as JSON
            .then(res => res.json())
            .then(res => {
                // Write "Welcome <user name>" to the documents body
                const nameNode = document.createTextNode(`Welcome, ${res.result.profile.name}`)
                document.body.appendChild(nameNode)
            });
    }
</script>

</html>